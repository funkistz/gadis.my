<!--
  Generated template for the MyshopPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar>
    <ion-title>My Shop {{ debug }}</ion-title>
    <ion-spinner name="bubbles" *ngIf="!loaded" float-right></ion-spinner>
    <ion-buttons end *ngIf="loaded">
      <button ion-button icon-only color="royal" (click)="refreshPage()">
        <ion-icon name="refresh"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

  <div padding-right padding-left style="height: 42px; background-color: #fff;">
    <ion-segment [(ngModel)]="segment" (ionChange)="segmentChanged($event)" *ngIf="role == 'dc_vendor' && customerLoaded">
      <ion-segment-button value="shop">
        Details
      </ion-segment-button>
      <ion-segment-button value="product">
        Products
      </ion-segment-button>
      <ion-segment-button value="order">
        Orders
      </ion-segment-button>
      <ion-segment-button value="other">
        Others
      </ion-segment-button>
    </ion-segment>
  </div>

</ion-header>

<ion-content>

  <ion-refresher (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div *ngIf="loaded">

    <!-- <ion-grid *ngIf="!shop.id">
    <ion-row padding text-center>

      <ion-spinner name="bubbles" *ngIf="!isShopLoaded && isLogin"></ion-spinner>

      <button ion-button (click)="createShop()" color="primary" block *ngIf="!shop.id && isShopLoaded && isLogin">
        <ion-icon name="star" item-end></ion-icon>
        Create shop
      </button>

    </ion-row>
  </ion-grid> -->

    <!-- if not login -->
    <ion-card *ngIf="!user && userLoaded">

      <ion-card-header>
        Please login first to setup your shop
      </ion-card-header>

      <ion-card-content>
        <button ion-item (click)="accountPage()">
          <ion-icon name="log-in" item-start></ion-icon>
          Login
        </button>
      </ion-card-content>

    </ion-card>

    <div *ngIf="user && userLoaded">

      <!-- if pending vendor -->
      <ion-card *ngIf="role == 'dc_pending_vendor' && customerLoaded">

        <ion-card-content>

          <h3 text-center>Congratulations! You have successfully applied as a Vendor. Please wait for further notifications from the admin.</h3>

          <button ion-item (click)="checkShop(user.ID)">
            <ion-icon name="refresh" item-start></ion-icon>
            Check Again
          </button>
        </ion-card-content>

      </ion-card>

      <!-- if not vendor -->
      <ion-card *ngIf="role == 'customer' && customerLoaded">

        <ion-card-header>
          Sell Anything
        </ion-card-header>

        <ion-card-content>

          <button ion-button full icon-start (click)="registerPage()">
            <ion-icon name="star"></ion-icon>
            Apply as vendor now!
          </button>

        </ion-card-content>

      </ion-card>

    </div>

    <div [ngSwitch]="segment">
      <div *ngSwitchCase="'shop'">

        <div *ngIf="shop && user">

          <div relative overflow class="account-header" text-center>
            <div float-left width-100>
              <woo-image [id]="shop.banner" type="width"></woo-image>
            </div>
            <div mark absolute top left width-100 height-100></div>
            <ion-row center padding absolute top left width-100 height-100>
              <ion-col secondary>
                <div>
                  <div class="account-avatar" margin-auto>
                    <div width-100 height-100>
                      <woo-image [id]="shop.image"></woo-image>
                    </div>
                  </div>
                </div>
              </ion-col>
            </ion-row>
          </div>

          <div text-right padding-right>
            <button ion-button (click)="storeFrontPage()">Update</button>
          </div>

          <form [formGroup]="formEdit" *ngIf="info" padding>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-label stacked>
                <span dark>Store Name *</span>
              </ion-label>
              <ion-input dark type="text" formControlName="name" placeholder="Name" readonly></ion-input>
            </ion-item>

            <!-- <ion-item mode="md" bg-transparent no-padding>
                <ion-label stacked>
                  <span dark>Store Slug *</span>
                </ion-label>
                <ion-input dark type="text" formControlName="slug" placeholder="Slug" readonly></ion-input>
              </ion-item> -->

            <ion-item mode="md" bg-transparent no-padding>
              <ion-label stacked>
                <span dark>Store Description *</span>
              </ion-label>
              <ion-textarea dark type="text" formControlName="description" placeholder="Description" readonly></ion-textarea>
            </ion-item>

            <!-- <ion-item mode="md" bg-transparent no-padding>
                <ion-label stacked>
                  <span dark>Message to Buyers</span>
                </ion-label>
                <ion-textarea dark type="text" formControlName="message_to_buyers" placeholder="Message to Buyers" readonly></ion-textarea>
              </ion-item> -->

            <ion-item mode="md" bg-transparent no-padding>
              <ion-label stacked>
                <span dark>Phone</span>
              </ion-label>
              <ion-input dark type="text" formControlName="phone" placeholder="phone" readonly></ion-input>
            </ion-item>

            <h4>
              Address
            </h4>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-input dark type="text" placeholder="Address Line 1" formControlName="address_1" readonly></ion-input>
            </ion-item>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-input dark type="text" placeholder="Address Line 1" formControlName="address_2" readonly></ion-input>
            </ion-item>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-input dark type="text" placeholder="Country" formControlName="country" readonly></ion-input>
            </ion-item>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-input dark type="text" placeholder="State" formControlName="state" readonly></ion-input>
            </ion-item>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-input dark type="text" placeholder="City" formControlName="city" readonly></ion-input>
            </ion-item>

            <ion-item mode="md" bg-transparent no-padding>
              <ion-input dark type="text" placeholder="ZIP Code" formControlName="postcode" readonly></ion-input>
            </ion-item>

          </form>

        </div>

      </div>
      <div *ngSwitchCase="'product'">

        <ion-spinner name="bubbles" *ngIf="!productLoaded && shop"></ion-spinner>

        <ion-list>
          <ion-item *ngIf="productLoaded && products.length <= 0">
            <h2>No product found</h2>
          </ion-item>
          <ion-item-sliding *ngFor="let product of products">

            <ion-item>
              <ion-thumbnail item-start>
                <img [src]="product.modernshop_images[0].modern_square">
              </ion-thumbnail>
              <h2>{{ product.name }}</h2>
              <h3>{{ product.price }}</h3>
              <p>
                <ion-badge *ngFor="let cat of product.categories">{{ cat.name }}</ion-badge>
              </p>
              <button ion-button clear item-end [navPush]="BrowserPage" [navParams]="{username: customer.username ,task:'add-product/' + product.id}">Edit</button>
            </ion-item>
            <ion-item-options side="right">
              <button ion-button color="danger" (click)="deleteProduct(product)">
                <ion-icon name="trash"></ion-icon>
                Delete
              </button>
            </ion-item-options>

          </ion-item-sliding>
        </ion-list>

      </div>
      <div *ngSwitchCase="'order'">


      </div>
      <div *ngSwitchCase="'other'">

        <ion-list>
          <button ion-item [navPush]="BrowserPage" [navParams]="{username: customer.username ,task:'vendor-report'}">
            Reports
          </button>
          <button ion-item [navPush]="BrowserPage" [navParams]="{username: customer.username ,task:'vendor-withdrawal'}">
            Payments Withdrawal
          </button>
          <button ion-item [navPush]="BrowserPage" [navParams]="{username: customer.username ,task:'transaction-details'}">
            Payments History
          </button>
        </ion-list>

      </div>
    </div>

    <iframe [src]='safeURL' width="100%" height="100%" frameborder="0" class="iframe" [ngStyle]="{'visibility':orderStyle}" *ngIf="user && shop"></iframe>

    <!-- <div *ngIf="user && shop"> -->

    <!-- <iframe [src]='storeFrontURL' width="100%" height="100%" frameborder="0" class="iframe" [ngStyle]="{'visibility':shopStyle}"
      (load)="dismissLoading()"></iframe> -->
    <!-- <iframe [src]='safeURL' width="100%" height="100%" frameborder="0" class="iframe" [ngStyle]="{'visibility':orderStyle}" *ngIf="shop"></iframe> -->

    <!-- </div> -->

    <ion-fab right bottom *ngIf="fab">
      <button ion-fab (click)="createProductPage()">
        <ion-icon name="add"></ion-icon>
      </button>
    </ion-fab>

  </div>

</ion-content>